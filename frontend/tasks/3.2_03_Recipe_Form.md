# Recipe Form Screen Implementation - TODO

**Requirements**: Section 3.2, Step 3 from requirements.md

---

## ğŸ“‹ Implementation Checklist

### âœ… Core Requirements
- [ ] **Form Navigation Integration**
  - Navigate from Recipe List FAB for creating new recipe
  - Navigate from Recipe Detail edit action for updating recipe
  - Handle create vs edit modes with different API endpoints
  - Pass recipe ID parameter for edit mode
  - Maintain navigation state and back button behavior

- [ ] **Basic Info Section**
  - Recipe title input field with validation
  - Recipe description textarea with character limit
  - Category dropdown or picker selection
  - Image picker with camera and gallery options
  - Image preview with placeholder and remove functionality
  - Required field validation and visual indicators

- [ ] **Ingredients Section**
  - Dynamic list of ingredient entries
  - Each ingredient: name, quantity, unit fields
  - Add new ingredient button with smooth animation
  - Remove ingredient with confirmation
  - Drag-to-reorder functionality (optional enhancement)
  - Validation for required ingredient fields

- [ ] **Cooking Steps Section**
  - Dynamic list of cooking step entries
  - Each step: step number (auto), instruction text
  - Add new step button with automatic numbering
  - Remove step with re-numbering of subsequent steps
  - Drag-to-reorder functionality with number updates
  - Validation for required step instruction

- [ ] **Form Validation**
  - Required fields: title, description, category, at least one ingredient, at least one step
  - Field-level validation with real-time feedback
  - Image size and type validation (max 5MB, common formats)
  - Form submission validation with error highlighting
  - Integration with react-hook-form and Yup schemas

- [ ] **Form Submission**
  - Create mode: POST to `/recipes` with form data
  - Edit mode: PUT to `/recipes/:id` with updated data
  - Loading states during submission with disabled form
  - Success feedback with navigation back to previous screen
  - Error handling with specific field error messages
  - Image upload handling with progress indication

### ğŸ¨ Design Requirements

- [ ] **Dark Theme Implementation**
  - Consistent with existing orange theme (#FF6B35)
  - Dark background colors (#121212, #1E1E1E)
  - High contrast text colors (#FFFFFF, #B3B3B3)
  - Orange accents for interactive elements and validation

- [ ] **Multi-Section Form Layout**
  - Scrollable form with distinct sections
  - Section headers with clear visual separation
  - Card-based or grouped section design
  - Proper spacing between form elements
  - Sticky or floating save/submit button

- [ ] **Image Picker Design**
  - Large image preview area with rounded corners
  - Placeholder image with upload icon and text
  - Camera and gallery selection options
  - Remove image action with confirmation
  - Loading state during image processing

- [ ] **Dynamic List Design**
  - Ingredients and steps in expandable card format
  - Add buttons with plus icons and labels
  - Remove buttons with proper confirmation
  - Smooth animations for add/remove actions
  - Clear visual hierarchy and numbering

- [ ] **Form Input Design**
  - Consistent input field styling with existing TextInput
  - Proper label positioning and spacing
  - Validation error styling with red indicators
  - Focus states with orange accent colors
  - Appropriate keyboard types for different inputs

- [ ] **Responsive Layout**
  - Works on phones and tablets
  - Keyboard-aware scrolling and form adjustment
  - Safe area handling for notched devices
  - Proper touch targets â‰¥ 44px
  - Optimized for portrait orientation

### ğŸ”§ Technical Implementation

- [ ] **Dependencies**
  - react-hook-form for form state management
  - Yup for validation schema definition
  - expo-image-picker for image selection
  - expo-image for optimized image display
  - Use existing components (Button, TextInput, etc.)

- [ ] **Form Management**
  - useForm hook with validation mode and resolver
  - Field registration with proper validation rules
  - Watch for real-time validation feedback
  - Handle form reset and initial values for edit mode
  - Dynamic field arrays for ingredients and steps

- [ ] **Image Handling**
  - expo-image-picker for camera and gallery access
  - Image compression and resizing for upload
  - Base64 encoding or FormData for API submission
  - Image caching and local storage management
  - Proper cleanup of temporary image files

- [ ] **API Integration**
  - Use existing apiService.createRecipe() method
  - Use existing apiService.updateRecipe(id) method
  - Handle multipart/form-data for image uploads
  - Loading, success, and error state management
  - Optimistic updates with rollback on failure

- [ ] **Validation Schemas**
  - Yup schemas for each form section
  - Custom validation for ingredient and step arrays
  - Image validation for size, type, and dimensions
  - Conditional validation based on form mode
  - Internationalized error messages

- [ ] **Custom Hooks**
  - useRecipeForm hook for form state and submission
  - useImagePicker hook for image selection logic
  - useDynamicFields hook for ingredients/steps management
  - useFormValidation hook for real-time validation
  - Integration with existing hooks

- [ ] **Performance Optimization**
  - Debounced validation for text inputs
  - Memoized components with React.memo
  - Efficient re-rendering optimization
  - Image compression for better performance
  - Lazy loading of form sections

- [ ] **Anonymous Mode Support**
  - Form works with mock data in demo mode
  - Simulate API calls with mock responses
  - Demo banner awareness
  - All form features available without authentication
  - Local storage simulation for created recipes

### ğŸ“ File Structure

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ RecipeForm/
â”‚   â”‚   â”œâ”€â”€ RecipeForm.tsx (new)
â”‚   â”‚   â””â”€â”€ index.ts (new)
â”‚   â”œâ”€â”€ BasicInfoSection/
â”‚   â”‚   â”œâ”€â”€ BasicInfoSection.tsx (new)
â”‚   â”‚   â””â”€â”€ index.ts (new)
â”‚   â”œâ”€â”€ IngredientsSection/
â”‚   â”‚   â”œâ”€â”€ IngredientsSection.tsx (new)
â”‚   â”‚   â””â”€â”€ index.ts (new)
â”‚   â”œâ”€â”€ StepsSection/
â”‚   â”‚   â”œâ”€â”€ StepsSection.tsx (new)
â”‚   â”‚   â””â”€â”€ index.ts (new)
â”‚   â”œâ”€â”€ ImagePicker/
â”‚   â”‚   â”œâ”€â”€ ImagePicker.tsx (new)
â”‚   â”‚   â””â”€â”€ index.ts (new)
â”‚   â”œâ”€â”€ DynamicFieldList/
â”‚   â”‚   â”œâ”€â”€ DynamicFieldList.tsx (new)
â”‚   â”‚   â””â”€â”€ index.ts (new)
â”‚   â””â”€â”€ index.ts (updated)
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ RecipeFormScreen/
â”‚   â”‚   â”œâ”€â”€ RecipeFormScreen.tsx (new)
â”‚   â”‚   â””â”€â”€ index.ts (new)
â”‚   â””â”€â”€ index.ts (updated)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useRecipeForm.ts (new)
â”‚   â”œâ”€â”€ useImagePicker.ts (new)
â”‚   â”œâ”€â”€ useDynamicFields.ts (new)
â”‚   â””â”€â”€ index.ts (updated)
â”œâ”€â”€ validation/
â”‚   â”œâ”€â”€ recipeFormSchema.ts (new)
â”‚   â””â”€â”€ index.ts (updated)
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ recipeForm.ts (new)
â”‚   â””â”€â”€ index.ts (updated)
```

### ğŸ§ª Testing Requirements

- [ ] **Component Tests**
  - RecipeForm rendering in create and edit modes
  - BasicInfoSection input handling and validation
  - IngredientsSection add/remove functionality
  - StepsSection dynamic list management
  - ImagePicker selection and preview
  - DynamicFieldList reordering and validation

- [ ] **Form Validation Tests**
  - Required field validation across all sections
  - Image validation for size, type, and format
  - Dynamic field validation for ingredients and steps
  - Real-time validation feedback
  - Form submission validation flow
  - Error message display and clearing

- [ ] **Integration Tests**
  - Form submission for create and edit modes
  - Navigation from Recipe List and Recipe Detail
  - API integration with success and error handling
  - Image upload and processing flow
  - Form reset and initial values for edit mode
  - Back navigation with unsaved changes warning

- [ ] **User Interaction Tests**
  - Form input and navigation flow
  - Dynamic field addition and removal
  - Image picker camera and gallery selection
  - Form submission and loading states
  - Keyboard handling and form scrolling
  - Validation error display and recovery

- [ ] **Accessibility Tests**
  - Screen reader compatibility for form elements
  - Proper form labels and associations
  - Focus management and tab order
  - Error announcement for validation failures
  - Touch target sizes (â‰¥44px)
  - Form completion feedback

### ğŸ¯ Acceptance Criteria

**Given** a user taps the FAB on Recipe List screen  
**When** they want to create a new recipe  
**Then** navigate to Recipe Form in create mode with empty form

**Given** a user taps the Edit button on Recipe Detail screen  
**When** they want to modify an existing recipe  
**Then** navigate to Recipe Form in edit mode with pre-filled recipe data

**Given** a user fills out the basic info section  
**When** they enter title, description, and select category  
**Then** validate fields in real-time and show validation feedback

**Given** a user adds ingredients to the recipe  
**When** they tap "Add Ingredient" and fill in name, quantity, and unit  
**Then** create new ingredient entry with validation and remove option

**Given** a user adds cooking steps to the recipe  
**When** they tap "Add Step" and enter instruction text  
**Then** create new numbered step with validation and remove option

**Given** a user selects an image for the recipe  
**When** they use the image picker from camera or gallery  
**Then** display image preview with remove option and validate image requirements

**Given** a user submits a valid recipe form  
**When** all required fields are filled and validation passes  
**Then** submit to appropriate API endpoint and navigate back with success feedback

**Given** a user submits an invalid recipe form  
**When** required fields are missing or validation fails  
**Then** highlight errors, show specific error messages, and prevent submission

**Given** a user is in anonymous mode  
**When** they use the recipe form  
**Then** all form functionality works with mock data and demo banner is visible

**Given** a user has unsaved changes  
**When** they attempt to navigate away from the form  
**Then** show confirmation dialog to prevent accidental data loss

**Given** a user experiences a network error during submission  
**When** the API call fails  
**Then** show error message with retry option and preserve form data

---

## ğŸš€ Implementation Priority

1. **Phase 1**: Basic form structure with navigation and section layout
2. **Phase 2**: Basic info section with title, description, category, and image picker
3. **Phase 3**: Dynamic ingredients section with add/remove functionality
4. **Phase 4**: Dynamic steps section with auto-numbering and validation
5. **Phase 5**: Form validation, submission, API integration, and error handling
6. **Phase 6**: Performance optimization, accessibility, and anonymous mode support

---

## ğŸ“Š Performance Targets

- **Form Load**: Display form within 200ms of navigation
- **Input Response**: Real-time validation feedback within 100ms
- **Image Processing**: Image selection and preview within 500ms
- **Form Submission**: API submission with loading feedback
- **Memory Usage**: Efficient handling of images and form data

---

## ğŸ”— Related Components

- **Existing**: Button, TextInput, ErrorMessage, SuccessMessage, ConfirmationDialog
- **Navigation**: Recipe List Screen (FAB create), Recipe Detail Screen (edit action)
- **Services**: apiService, mockApiService, image handling services
- **Theme**: Existing orange dark theme colors and typography
- **Validation**: Existing validation patterns and schemas

---

## ğŸ’¡ Additional Features (Future Enhancements)

- **Recipe Templates**: Pre-filled forms for common recipe types
- **Ingredient Suggestions**: Autocomplete for common ingredients
- **Unit Conversion**: Automatic conversion between measurement units
- **Recipe Import**: Import recipes from URLs or other formats
- **Collaborative Editing**: Multiple users editing the same recipe
- **Recipe Versioning**: Track changes and revert to previous versions
- **Nutritional Calculator**: Automatic nutrition facts calculation
- **Voice Input**: Voice-to-text for steps and ingredients

---

**Dependencies**: Recipe List Screen (3.2_01_Recipe_List.md), Recipe Detail Screen (3.2_02_Recipe_Details.md)  
**Estimated Effort**: 10-14 hours  
**Status**: âœ… Completed  
**Assignee**: Claude Code  
**Created**: 2025-08-18

---

## ğŸ”„ Navigation Integration

### Recipe List Integration
- [ ] **FAB Navigation**
  - Update FloatingActionButton to navigate to Recipe Form
  - Pass create mode parameter to form screen
  - Handle navigation state and transitions
  - Implement proper navigation typing

### Recipe Detail Integration
- [ ] **Edit Action**
  - Add Edit button to Recipe Detail action buttons
  - Pass recipe ID and edit mode to form screen
  - Pre-fill form with existing recipe data
  - Handle navigation back to detail screen

### Navigation Stack Updates
- [ ] **Route Configuration**
  - Add RecipeForm route to navigation stack
  - Configure screen options (title, back button)
  - Handle navigation params for create/edit modes
  - Implement proper screen transitions

- [ ] **State Management**
  - Handle navigation state persistence
  - Manage form data across navigation
  - Unsaved changes warning dialog
  - Success navigation after form submission

### Updated Acceptance Criteria

**Given** a user creates a new recipe successfully  
**When** the form submission completes  
**Then** navigate to the new Recipe Detail screen or back to Recipe List with success message

**Given** a user edits an existing recipe successfully  
**When** the form update completes  
**Then** navigate back to Recipe Detail screen with updated data and success message

**Given** a user cancels form editing with unsaved changes  
**When** they tap the back button or cancel action  
**Then** show confirmation dialog to prevent accidental data loss

**Given** a user completes form submission  
**When** navigating back to previous screen  
**Then** refresh data to reflect new or updated recipe information